# Add speaker name between quotation marks.
speaker$ = ""

# Specify which directory to put the log files in.
# Put path between quotation marks. (Do not include file name.)
# Be sure to include trailing slash.
# (Leave empty for current directory.)
filepath$ = ""

##################################
### DON'T EDIT BELOW THIS LINE ###
##################################

# Copyright (C) 2010 Gordon P. Hemsley
# Licensed under a simplified BSD License
# See LICENSE file for more details.

# Prompt the user for information about the vowel
form Record vowel data
	word Word
	word Vowel_name
endform

# Set defaults
measure_glide = 0
phthong = 1

# Prepare filenames
data_file$ = filepath$ + speaker$ + ".tsv"
glide_file$ = temporaryDirectory$ + "praat.norm.glide." + speaker$ + ".txt"

# Check to see if there is a glide open
if ( fileReadable ( glide_file$ ) )
	beginPause ( "Measure glide?" )
		comment ( "You have a glide measurement pending. Would you like to measure it now?" )
	measure_glide = endPause ( "Measure glide", "Skip glide", 1 )

#	printline 'measure_glide'
endif

# If there is no glide open, or an open glide was skipped,
# ask what we are going to measure now.
if ( ( measure_glide == 0 ) || ( measure_glide == 2 ) )
	beginPause ( "Select phthong" )
		comment ( "Please select phthong" )
	phthong = endPause ( "Monophthong", "Diphthong", 1 )

#	printline 'phthong'
endif

f1 = Get first formant
f2 = Get second formant
f3 = Get third formant

#printline 'f1' 'f2' 'f3'

# Write to the file
if ( !fileReadable ( data_file$ ) )
	fileappend 'data_file$' Speaker'tab$'Vowel'tab$'Word'tab$'F1'tab$'F2'tab$'F3'tab$'F1g'tab$'F2g'tab$'F3g'newline$'
endif

# If we have to measure a glide, write the values at the end of the line.
# If we skip an expected glide measurement, finish the line off empty.
if ( measure_glide != 0 )
	if ( measure_glide == 1 )
		fileappend 'data_file$' 'f1:0''tab$''f2:0''tab$''f3:0''newline$'
	elsif ( measure_glide == 2 )
		fileappend 'data_file$' 'tab$''tab$''newline$'
	endif

	filedelete 'glide_file$'
endif

# If we are measuring a new diphthong, write the beginning of the line.
# Otherwise, write the full line.
if ( measure_glide != 1 )
	if ( phthong == 2 )
		fileappend 'data_file$' 'speaker$''tab$''Vowel_name$''tab$''Word$''tab$''f1:0''tab$''f2:0''tab$''f3:0''tab$'

		# Create temp file to keep track of glides.
		data_file$ > 'glide_file$'
	else
		fileappend 'data_file$' 'speaker$''tab$''Vowel_name$''tab$''Word$''tab$''f1:0''tab$''f2:0''tab$''f3:0''tab$''tab$''tab$''newline$'
	endif
endif
